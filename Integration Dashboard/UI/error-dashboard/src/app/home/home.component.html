<div class="page-content">
    <div class="action-menu">
        <div class="row">
            <div class="col-md-6 col-sm-12 col-xs-12 d-flex">
                <button type="button" class="btn btn-primary btn-sm mr-3" (click)="toggleSearch()">Search</button>
                <!-- <button type="button" class="btn btn-primary btn-sm mr-3" (click)="resetData()">Refresh</button> -->
                <!-- <button type="button" class="btn btn-primary btn-sm mr-3" (click)="exportRecords()"
                    tooltil="Export records">Export All</button> -->
                <div class="dropdown">
                    <button class="btn btn-primary btn-sm mr-3 dropdown-toggle" type="button" id="dropdownMenuButton"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Export
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="#" (click)="exportRecords('all')">Export All Data</a>
                        <a class="dropdown-item" href="#" (click)="exportRecords('filtered')">Export Filtered Data</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-sm-12 col-xs-12"></div>
        </div>
    </div>
    <div class="search-panel">
        <mat-expansion-panel hideToggle [expanded]="searchPanelOpenState">
            <form [formGroup]="searchForm" class="search-form">
                <div class="row">
                    <div class="col-md-2 col-sm-12 col-xs-12">
                        <label for="searchForDate" class="label-default">From:</label>
                        <div class="input-group input-group-sm mb-3">
                            <input formControlName="fromDate" type="date" class="form-control"
                                aria-describedby="inputGroup-sizing-sm" id="searchForDate">
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-12 col-xs-12">
                        <label for="searchToDate" class="label-default">To:</label>
                        <div class="input-group input-group-sm mb-3">
                            <input formControlName="toDate" type="date" class="form-control"
                                aria-describedby="inputGroup-sizing-sm" id="searchToDate">
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-12 col-xs-12">
                        <label for="searchApp" class="label-default">Application:</label>
                        <div class="input-group input-group-sm mb-3">
                            <input formControlName="applicationName" type="search" class="form-control"
                                aria-describedby="inputGroup-sizing-sm" id="searchApp">
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-12 col-xs-12">
                        <label for="searchTrans" class="label-default">Transaction:</label>
                        <div class="input-group input-group-sm mb-3">
                            <input formControlName="transactionName" type="search" class="form-control"
                                aria-describedby="inputGroup-sizing-sm" id="searchTrans">
                        </div>
                    </div>
                    <!-- <div class="col-md-2 col-sm-12 col-xs-12">
                        <label for="searchTrans" class="label-default">Status:</label>
                        <div class="input-group input-group-sm mb-3">
                            <select class="custom-select" id="inputGroupSelect01" formControlName="status">
                                <option selected>Choose...</option>
                                <option value="success">Success</option>
                                <option value="failed">Failed</option>
                                <option value="na">NA</option>
                            </select>
                        </div>
                    </div> -->
                    <div class="col-md-4 col-sm-12 col-xs-12">
                        <button type="button" class="btn btn-outline-primary btn-sm search-btn mr-3" type="submit"
                            (click)="search()">Search</button>
                        <button type="button" class="btn btn-outline-primary btn-sm search-btn mr-3" type="submit"
                            (click)="resetData()">Reset</button>
                        <button type="button" class="btn btn-outline-primary btn-sm search-btn" type="submit"
                            (click)="cancelSearch()">Cancel</button>
                    </div>

                </div>
            </form>
        </mat-expansion-panel>
    </div>
    <div class="div-table">
        <table mat-table [dataSource]="errData.dashboardInfo" class="mat-elevation-z8 table-striped">

            <!--- Note that these columns can be defined in any order.
                  The actual rendered columns are set as a property on the row definition" -->

            <!-- Status Icon Column -->
            <!-- <ng-container matColumnDef="icon">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                    <i class="fa fa-lg" 
                    [ngClass]="element.recon_status == 'Success' ? 'fa-check-square status-success' 
                    : (element.recon_status == 'Fail' ? 'fa-exclamation-triangle status-fail' : 'fa-ban status-default')"></i>
    
                </td>
            </ng-container> -->

            <!-- Count Column -->
            <!-- <ng-container matColumnDef="n">
                <th mat-header-cell *matHeaderCellDef> # </th>
                <td mat-cell *matCellDef="let element;let i = index"> {{i+1 + (errData.pageNumber * errData.pageSize)}}</td>
            </ng-container> -->

            <!-- ID Column -->
            <!-- <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef> ID. </th>
                <td mat-cell *matCellDef="let element"> {{element.id}} </td>
            </ng-container> -->

            <!-- App Name Column -->
            <ng-container matColumnDef="customerName">
                <th mat-header-cell *matHeaderCellDef>Customer </th>
                <td mat-cell *matCellDef="let element"> {{element.customerName}} </td>
            </ng-container>

            <!-- App Name Column -->
            <ng-container matColumnDef="applicationName">
                <th mat-header-cell *matHeaderCellDef>Application </th>
                <td mat-cell *matCellDef="let element"> {{element.applicationName}} </td>
            </ng-container>


            <!-- Weight Column -->
            <ng-container matColumnDef="transactionName">
                <th mat-header-cell *matHeaderCellDef>Transaction </th>
                <td mat-cell *matCellDef="let element"> {{element.transactionName}} </td>
            </ng-container>

            <!-- Symbol Column -->
            <ng-container matColumnDef="sourceSystem">
                <th mat-header-cell *matHeaderCellDef> Source </th>
                <td mat-cell *matCellDef="let element"> {{element.sourceSystem}} </td>
            </ng-container>

            <!-- Target Column -->
            <ng-container matColumnDef="targetSystem">
                <th mat-header-cell *matHeaderCellDef> Target </th>
                <td mat-cell *matCellDef="let element"> {{element.targetSystem}} </td>
            </ng-container>


            <!-- File Uploaded Column -->
            <ng-container matColumnDef="fileUploaded">
                <th mat-header-cell *matHeaderCellDef> File Uploaded</th>
                <td mat-cell *matCellDef="let element"> {{element.fileUploaded}} </td>
            </ng-container>

            <!-- Uploaded on Column -->
            <ng-container matColumnDef="timestamp">
                <th mat-header-cell *matHeaderCellDef> Trans. Date & Time </th>
                <td mat-cell *matCellDef="let element"> {{element.timestamp | date: 'short'}} </td>
            </ng-container>

            <!-- Error Record Column -->
            <ng-container matColumnDef="errorRecord">
                <th mat-header-cell *matHeaderCellDef> Error Log</th>
                <td mat-cell *matCellDef="let element">
                    <a (click)="viewFile(element.errorRecord)" href="#" title="View Error" class="m-r-5">
                        {{element.errorRecord}} </a>
                    <i class="fa fa-download cursor-pointer color-default" title="Download Error" aria-hidden="true"
                        (click)="downloadRecord()"></i>
                </td>
            </ng-container>

            <!-- User Column -->
            <ng-container matColumnDef="userName">
                <th mat-header-cell *matHeaderCellDef> User</th>
                <td mat-cell *matCellDef="let element"> {{element.userName}} </td>
            </ng-container>
            <!-- Total Count Column -->
            <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef class="text-right"> Total </th>
                <td mat-cell *matCellDef="let element" class="text-right"> {{element.total}} </td>
            </ng-container>


            <!-- Success Count Column -->
            <ng-container matColumnDef="success">
                <th mat-header-cell *matHeaderCellDef class="text-right"> Success </th>
                <td mat-cell *matCellDef="let element" class="text-right"> {{element.success}} </td>
            </ng-container>

            <!-- Failed Count Column -->
            <ng-container matColumnDef="failed">
                <th mat-header-cell *matHeaderCellDef class="text-right"> Failed </th>
                <td mat-cell *matCellDef="let element" class="text-right"> {{element.failed}} </td>
            </ng-container>
            <!-- Updated on Column -->
            <!-- <ng-container matColumnDef="last_updated">
                <th mat-header-cell *matHeaderCellDef> Updated On </th>
                <td mat-cell *matCellDef="let element"> {{element.last_updated | date: 'short'}} </td>
            </ng-container> -->

            <!-- Status Column -->
            <ng-container matColumnDef="recon_status">
                <th mat-header-cell *matHeaderCellDef> Status </th>
                <td mat-cell *matCellDef="let element">

                    <span>
                        <i class="fa-lg"
                            [ngClass]="element.recon_status == 'success' ? 'far fa-check-square status-success' 
                    : (element.recon_status == 'failed' ? 'fas fa-exclamation-triangle status-fail' : 'far fa-clock status-default')"></i>
                        &nbsp;
                    </span>
                    <span
                        [ngClass]="element.recon_status == 'success' ? 'status-success' : (element.recon_status == 'failed' ? 'status-fail' : 'status-default')">{{element.recon_status}}
                    </span>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="errDataCols"></tr>
            <tr mat-row *matRowDef="let row; columns: errDataCols;"></tr>
        </table>
        <div class="no-data-found-div font-italic"
            *ngIf="errData.dashboardInfo &&  errData.dashboardInfo.filteredData && errData.dashboardInfo.filteredData.length == 0">
            <span>No records found</span>
        </div>
        <mat-paginator class="paginator" #paginator [length]="errData.totalElements"
            [pageSize]="PAGINATOR_CONST.defaultPageSize" [pageSizeOptions]="PAGINATOR_CONST.pageSizeOptions"
            showFirstLastButtons>
        </mat-paginator>
    </div>
</div>
<div class="dialog">
    <ng-template #callAPIDialog>
        <!-- <h2 mat-dialog-title>Install Angular</h2> -->
        <div mat-dialog-title>
            <div class="border-btm">
                <div class="row mb-3">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <label for="searchForDate" class="label-default">File Name:&nbsp;</label>
                        <span class="display-file-name">{{errorRecordDetails.fileName}}</span>
                        <button mat-dialog-close class="float-right btn btn-primary btn-sm mr-3">Close</button>
                        <button type="button" class="float-right btn btn-primary btn-sm mr-3" (click)="downloadRecord()"
                            tile="Download Record as File" cdkFocusInitial>Download</button>
                        <!-- <button type="button" class="float-right btn btn-primary btn-sm mr-3" (click)="downloadRecord()"
                            tile="Download Record as File">Download</button> -->
                    </div>
                </div>
            </div>
        </div>
        <mat-dialog-content class="mat-typography">
            <div class="page-content">
                <div class="file-contents">
                    <p class="view-error-panel">{{errorRecordDetails.data}}</p>
                </div>
            </div>
        </mat-dialog-content>
        <!-- <mat-dialog-actions align="end"> -->
        <!-- <button type="button" class="float-right btn btn-primary btn-sm mr-3" (click)="downloadRecord()"
                tile="Download Record as File" cdkFocusInitial>Download</button>
            <button mat-dialog-close class="float-right btn btn-primary btn-sm mr-3">Close</button> -->
        <!-- <button mat-button [mat-dialog-close]="true" cdkFocusInitial>Install</button> -->
        <!-- </mat-dialog-actions> -->
    </ng-template>
</div>